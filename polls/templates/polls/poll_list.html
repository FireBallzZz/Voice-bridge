{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
  /* Light Theme Variables */
  body {
    --bg-color: #ffffff;
    --text-color: #121212;
    --card-bg: #C7F4DA;
    --card-border: rgba(0, 0, 0, 0.1);
    --transparent-box-bg: #FFFFFF;
    --transparent-box-border: rgba(0, 0, 0, 0.1);
    --btn-primary-color: #0d6efd;
    --btn-primary-text: #ffffff;
    --btn-custom-border: #000000;
    --btn-custom-text: #121212;
    transition: all 0.3s ease;
  }

  /* Dark Theme Overrides */
  body.dark-theme {
    --bg-color: #121212;
    --text-color: #f5f5f5;
    --card-bg: rgba(25, 25, 25, 0.85);
    --card-border: rgba(255, 255, 255, 0.15);
    --transparent-box-bg: rgba(40, 40, 40, 0.75);
    --transparent-box-border: rgba(255, 255, 255, 0.15);
    --btn-primary-color: #0d6efd;
    --btn-primary-text: #ffffff;
    --btn-custom-border: #ffffff;
    --btn-custom-text: #ffffff;
  }

  body {
    background: url("{% static 'images/7.png' %}") no-repeat center center;
    background-size: cover;
    background-attachment: scroll;
    color: var(--text-color);
    min-height: 100vh;
    position: relative;
  }

  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.4); /* overlay for readability */
    z-index: -1;
  }

  /* Cards */
  .card {
    background-color: var(--card-bg);
    border: 1px solid var(--card-border);
    color: var(--text-color);
    border-radius: 12px;
    transition: all 0.3s ease;
  }

  .card-title {
    color: var(--text-color);
  }

  .list-group-item {
    background-color: var(--card-bg);
    color: var(--text-color);
    border: 1px solid var(--card-border);
    transition: all 0.3s ease;
  }

  .transparent-box {
    background-color: var(--transparent-box-bg);
    border: 1px solid var(--transparent-box-border);
    border-radius: 10px;
    padding: 15px 20px;
    margin-bottom: 20px;
    transition: all 0.3s ease;
  }

  .custom-poll-btn {
    background-color: transparent;
    color: var(--btn-custom-text);
    border: 2px solid var(--btn-custom-border);
    transition: all 0.3s ease-in-out;
    font-weight: bold;
    padding: 8px 16px;
    border-radius: 8px;
  }

  .custom-poll-btn:hover {
    background-color: rgba(255, 193, 7, 0.2);
    box-shadow: 0 4px 10px rgba(255, 193, 7, 0.3);
  }

  .poll-action-btn {
    background-color: transparent;
    border: 1px solid var(--btn-primary-color);
    color: var(--btn-primary-color);
    padding: 5px 10px;
    margin-left: 5px;
    border-radius: 6px;
    font-size: 13px;
    transition: 0.3s ease-in-out;
  }

  .poll-action-btn:hover {
    background-color: var(--btn-primary-color);
    color: var(--btn-primary-text);
  }

  .form-check-label {
    color: var(--text-color);
  }

  .alert {
    color: #000;
  }

  @media (max-width: 576px) {
    .custom-poll-btn, .poll-action-btn {
      font-size: 14px;
      padding: 6px 12px;
    }
  }
</style>

<!-- Flash Messages -->
{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">üó≥Ô∏è Public Polls</h2>
  {% if user.is_authenticated and user.is_govt %}
    <a class="btn custom-poll-btn" href="{% url 'create_poll' %}">‚ûï Create Poll</a>
  {% endif %}
</div>

{% for poll in polls %}
  <div class="card mb-4 shadow">
    <div class="card-body">
      <h5 class="card-title">{{ poll.question }}</h5>

      <!-- Voting Box -->
      <div class="transparent-box">
        {% if poll.user_has_voted %}
          <p class="text-success">‚úÖ You have already voted.</p>
        {% else %}
          <form method="POST" action="{% url 'vote_poll' poll.id %}">
            {% csrf_token %}
            {% for option in poll.get_options %}
              <div class="form-check">
                <input class="form-check-input" type="radio" name="choice" value="{{ option }}" id="{{ option }}{{ poll.id }}">
                <label class="form-check-label" for="{{ option }}{{ poll.id }}">{{ option }}</label>
              </div>
            {% endfor %}
            <div class="text-end mt-3">
              <button type="submit" class="btn custom-poll-btn">Vote</button>
            </div>
          </form>
        {% endif %}
      </div>

      <!-- Results Box -->
      <div class="transparent-box mt-3">
        <strong>üìä Results:</strong>
        <ul class="list-group list-group-flush mt-2">
          {% if poll.option1 %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{ poll.option1 }}
              <span class="badge bg-success rounded-pill">{{ poll.option1_votes }}</span>
            </li>
          {% endif %}
          {% if poll.option2 %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{ poll.option2 }}
              <span class="badge bg-success rounded-pill">{{ poll.option2_votes }}</span>
            </li>
          {% endif %}
          {% if poll.option3 %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{ poll.option3 }}
              <span class="badge bg-success rounded-pill">{{ poll.option3_votes }}</span>
            </li>
          {% endif %}
          {% if poll.option4 %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{ poll.option4 }}
              <span class="badge bg-success rounded-pill">{{ poll.option4_votes }}</span>
            </li>
          {% endif %}
        </ul>
      </div>

      {% if user.is_authenticated and user == poll.created_by %}
        <div class="mt-3 text-end">
          <a href="{% url 'edit_poll' poll.id %}" class="poll-action-btn">‚úèÔ∏è Edit</a>
          <a href="{% url 'delete_poll' poll.id %}" class="poll-action-btn">üóëÔ∏è Delete</a>
        </div>
      {% endif %}
    </div>
  </div>
{% empty %}
  <p>No polls found.</p>
{% endfor %}

{% endblock %}
